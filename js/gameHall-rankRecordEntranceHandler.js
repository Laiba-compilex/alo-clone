"undefined"==typeof RankRecordEntranceHandler&&(RankRecordEntranceHandler={}),function(){let e=0,a=0,t=0,n=0,o=!1,r=!1,l=0,i=0,d=!1,s=!1,c=[],m=[],g=[];function f(){if(!o){let n=$j("#firstTabClock"),o=e+24*l;n.find("#clockHour").text(o<10?"0"+o:o),n.find("#clockMinute").text(a<10?"0"+a:a),n.find("#clockSecond").text(t<10?"0"+t:t)}if(!r){let n=$j("#secondTabClock"),o=e+24*i;n.find("#clockHour").text(o<10?"0"+o:o),n.find("#clockMinute").text(a<10?"0"+a:a),n.find("#clockSecond").text(t<10?"0"+t:t)}}function p(){let e={isLastTerm:!1};PageConfig.isLogin||(e.webSiteType=PageConfig.webSiteType,e.userId=PageConfig.shId),$j("#parentGameDiv").is(":visible")||$j("#listFrame").is(":visible")?setTimeout(function(){p()},PageConfig.playerGetRankRecordInterval):$j.ajax({type:"POST",url:PageConfig.getRankRecord,dataType:"json",data:e,success:function(e){RankRecordEntranceHandler.buildRankRecordContent(e)},complete:function(){f(),setTimeout(function(){p()},PageConfig.playerGetRankRecordInterval)}})}function y(e,a){let t=1===a,f=t?"firstTab":"secondTab",p=e.rankRecordSetting,y=e.rankRecord,u=p.isOnlyWeek,R=p.rankType,k="RANK_BY_RATE"===R,C="RANK_BY_TURNOVER"===R,h="RANK_BY_ACCUMULATE_AMOUNT"===R,T=u?p.weeklyRankLimit:p.dailyRankLimit,w=p.tabClassName,P=p.allowGameType?p.allowGameType.split(",")[0]:"SLOT",b=p.allowPlatformArr,A=p.isAutoReward;$j("#"+f).toggleClass("turnover-list",C);let j=JCache.get("#"+f+"TournamentList");if(C?($j("#"+f+"SubTitle").text(I18N.get("player.rankRecord.turnover")),j.attr("class","tournament-list turnover")):h?($j("#"+f+"SubTitle").text("Total Win"),j.attr("class","tournament-list winAmount")):k?($j("#"+f+"SubTitle").text(I18N.get("player.rankRecord.winRatio")),j.attr("class","tournament-list winRatio")):($j("#"+f+"SubTitle").text(I18N.get("player.rankRecord.winAmount")),j.attr("class","tournament-list winAmount")),u){if($j("#"+f+"TournamentDate").show().text(p.displayName),p.isOver){let e=JCache.get("#"+f+"Clock");e.find("#clockHour").text("00"),e.find("#clockMinute").text("00"),e.find("#clockSecond").text("00"),t?o=!0:r=!0}t?l=p.weeklyDay:i=p.weeklyDay}p.isMultiPlatform||($j("#"+f+"PlatformLogo").find("img").remove(),GameHallUtils.setPlatformImg($j("#"+f),"#"+f+"PlatformLogo",w)),PageConfig.isLogin&&$j("#"+f+"PlatformLogo").bind("click",function(){WindowEventUtil.stopEvent(event,!0,!0),GameHallUtils.isBS()||PageConfig.isMobile&&GameHallUtils.isNEW()?GameHallHandler.switchGameTypePage(P,b[0]):"LIVEARENA"===P||"LIVE"===P?GameHallHandler.switchGamePage(P.toLowerCase()):GameHallHandler.openGamePage(b[0],P.toLowerCase())});let S=u?y.timelyWeek[1]:y.timely[1];S.length>0&&(p.isAllowAllPlatform||p.allowPlatformArr.forEach(e=>{p.allowGameTypeArr.forEach(a=>{PageConfig.hasTouranmentPlatform[e+"_"+a]=p.rankRecordSettingKey})}),n++,$j("#"+f).show().attr("class",(u?"weekly":"daily")+" box-"+n+(A?"":" no-prize")),S.length>2&&(d=!0),u&&(s=!0),function(e,a,t){if(g[a]){let n=g[a];if(e.length!=n.length)return!0;let o=Math.min(e.length,t);for(let a=0;a<o;a++){let t=e[a],o=n[a];if(t.syncUserId!=o.syncUserId)return!0;if(t.winAmt!=o.winAmt||t.winRate!=o.winRate)return!0}return!1}return!0}(S,a,T)&&(j.empty(),function(e,a,t){let n="RANK_BY_TURNOVER"===t.rankType,o="RANK_BY_RATE"===t.rankType,r="RANK_BY_ACCUMULATE_AMOUNT"===t.rankType,l=n||r,i=t.tabClassName,d=t.allowGameType?t.allowGameType.split(",")[0]:"SLOT",s=t.isMultiSite,g=t.isOnlyWeek,f=g?t.weeklyRankLimit:t.dailyRankLimit,p=PageConfig.topGameInfo,y=JCache.get("#rankTemplate"),u=t.isAutoReward,R=Math.min(f,a.length);for(let n=0;n<a.length;n++){let r=a[n],g=r.rank,f=y.clone().show();f.attr("id","rankTemplate"+g),f.find("#rankNo").text(g),PageConfig.playerSyncUserId===r.syncUserId?(f.addClass("is-you"),f.find("#userName").text(PageConfig.playerName)):f.find("#userName").text(r.name),o?(f.find("#rankInfo").addClass("info-ratio"),f.find("#currency").remove(),f.find("#winAmt").addClass("ratio").text(Math.round(100*r.winRate)/100+" X")):(f.find("#rankInfo").addClass("info-amount"),f.find("#winAmt").addClass("amount").text(NumberFormatUtil.formatFormattedNumber(r.winAmt.toString(),0))),g<=3&&f.find("#rankNo").addClass("award-"+g);let k=f.find("#gameIconDiv");if(l)if(p&&p[t.id]){let e=p[t.id],a=e[n%e.length];f.find("#imgUrl").attr("src",a.imgUrl),PageConfig.isLogin&&k.attr("platform",a.platform).attr("game_code",a.gameCode).attr("game_key",a.gameKey).attr("gameType",a.gameType).attr("onclick","RankRecordEntranceHandler.playGame(this)")}else k.hide();else if(f.find("#imgUrl").attr("src",r.imgUrl),PageConfig.isLogin){const e=JSON.parse(r.gameInfoJson);k.attr("platform",r.platform).attr("game_code",r.gameCode).attr("game_key",r.gameKey).attr("gameType",e.gameType).attr("onclick","RankRecordEntranceHandler.playGame(this)")}u&&g<=R?f.find("#prize").text(NumberFormatUtil.formatNumber(r.prize,0)):f.find("#prize").remove(),i!=d?f.find("#platformIcon").remove():(f.find("#platformIcon").addClass("icon-"+r.platform),t.isMultiPlatform||GameHallUtils.setPlatformImg(f,"#imgPlatformLogo",r.platform));let C="JDB"===r.platform&&"SLOT"===r.gameType&&c.length>0&&c.includes(r.gameCode),h="JILI"===r.platform&&"SLOT"===r.gameType&&m.length>0&&m.includes(r.gameCode);s&&!C&&!h||l?f.find("#btnReplay").remove():PageConfig.isLogin&&f.find("#btnReplay").attr("onclick",`RankRecordEntranceHandler.getOutsideGameDetail(${JSON.stringify(r.gameInfoJson)}, "${r.currency}")`),e.append(f)}}(j,S,p))),g[a]=S}function u(e){switch(e){case 1:default:return"firstTab";case 2:return"secondTab";case 3:return"thirdTab"}}RankRecordEntranceHandler.init=function(){c=PageConfig.jdbSupReplayGameIds?PageConfig.jdbSupReplayGameIds.split(","):[],m=PageConfig.jiliSupReplayGameIds?PageConfig.jiliSupReplayGameIds.split(","):[],PageConfig.isMobile||JCache.get("#tournament").click(function(){window.open($j(this).attr("path"),"_blank","width=1300,height=600,top=5,left=5,toolbar=no,menubar=no,resizable=yes,scrollbars=yes,status=no,location=no,directories=no")}),RankRecordEntranceHandler.resetClock(),setInterval(function(){RankRecordEntranceHandler.resetClock()},1e3),PageConfig.isLogin||p()},RankRecordEntranceHandler.resetClock=function(){let n=new Date,o=DateUtil.getNextSettleTime(),r=Math.abs(o-n);t=Math.floor(r/1e3%60),a=Math.floor(r/6e4%60),e=Math.floor(r/36e5%24),f()},RankRecordEntranceHandler.buildRankRecordContent=function(e){displayOrder=0;let a=$j("#gameGroup");if(null==e||$j.isEmptyObject(e)||e.error){a.addClass("no-tournament");let t=JCache.get("#rankRecordArea");return null!=t&&($j("#RANKRECORDArea").hide(),t.hide(),PageConfig.hasFeatureArea||a.hide()),void(e.error&&alert(e.error))}a.removeClass("no-tournament");let t=0,l=[],i=document.getElementById("historyDataList");i.innerText="";for(let a in e){let n=e[a];if(n.rankRecordSetting.isComplete){let e=document.createElement("a");e.innerText=n.rankRecordSetting.displayName,PageConfig.isLogin&&e.setAttribute("onclick",'RankRecordEntranceHandler.openRankRecord("firstTab",'+n.rankRecordSetting.id+","+n.rankRecordSetting.displayOrder+")"),i.append(e),t++;continue}l[l.length]=n,PageConfig.showPromoGameTypeByPlatform&&n.rankRecordSetting.allowGameTypeArr.forEach(e=>{n.rankRecordSetting.allowPlatformArr.forEach(a=>{if(PageConfig.showPromoGameTypeByPlatform.has(e)){PageConfig.showPromoGameTypeByPlatform.get(e).add(a)}else PageConfig.showPromoGameTypeByPlatform.set(e,new Set([a]))})})}let c=["firstTab","secondTab"];if(2===l.length&&PageConfig.isNeedToChange&&!l[0].rankRecordSetting.isOnlyWeek&&!l[1].rankRecordSetting.isOnlyWeek){let e=l[0];l[0]=l[1],l[1]=e,c=["secondTab","firstTab"]}$j("#firstTab").hide(),$j("#secondTab").hide(),o=!1,r=!1,s=!1,n=0;for(let e=1;e<=l.length;e++){let a=l[e-1],t=u(e);y(a,e),PageConfig.isLogin&&$j("#"+t+"TournamentList").unbind("click").bind("click",()=>RankRecordEntranceHandler.openRankRecord(c[e-1]))}let m=document.getElementById("historyBox");if(m.style.display=0===t?"none":"",PageConfig.showPromoGameTypeByPlatform){let e=Array.from(PageConfig.showPromoGameTypeByPlatform).map(([e,a])=>[e,Array.from(a)]);localStorage.setItem("showPromoGameTypeByPlatform",JSON.stringify(e))}let g=JCache.get("#rankRecordArea");if(s?($j("#weeklyRankRecordArea").show(),1===n?g.attr("class","tournament-box only-weekly"):g.attr("class","tournament-box both")):g.attr("class","tournament-box only-daily"),g.toggleClass("over-2",d),g.addClass(n>1?"twoBox":"oneBox"),0!==n&&$j("#dailyRankRecordArea").show(),0===n)a.addClass("no-tournament"),null!=g&&($j("#RANKRECORDArea").hide(),g.hide(),PageConfig.hasFeatureArea||a.hide());else{g.show(),a.show();let e=$j("#dailyRankRecordArea");1===n?(e.removeClass("twoBox"),e.addClass("oneBox")):(e.removeClass("oneBox"),e.addClass("twoBox"))}},RankRecordEntranceHandler.openRankRecord=function(e,a,t){let n,o=PageConfig.rankRecordUrl+"?mode="+e;a?(o+="&specificSettingId="+a,o+="&displayOrder="+t,n=I18N.get("player.menu.tournamentHistory")):n=I18N.get("player.menu.tournament"),PageConfig.isMobile?GameHallUtils.isBS()?(JCache.get("#popframe").attr("src",o),JCache.get("#popTitle").text(n),JCache.get("body").addClass("body-report-iframe"),JCache.get("body").addClass("body-iframe"),PopupUtil.openModal("#pop_inpage")):($j("#downloadAppFooter").hide(),$j("#popframe").attr("src",o).parent().show(),$j("#popTitle").text(n),$j("#gameHallHeader").hide(),$j("#gameMenuTab").hide(),$j("#gameHallDiv").hide(),$j("#gameHallFooter").hide()):window.open(o,"_blank","width=1300,height=600,top=5,left=5,toolbar=no,menubar=no,resizable=yes,scrollbars=yes,status=no,location=no,directories=no")},RankRecordEntranceHandler.getOutsideGameDetail=function(e,a){WindowEventUtil.stopEvent(event,!0,!0);let t=JSON.parse(e);postAjax({url:PageConfig.outsideDetail,async:!1,type:"POST",data:{platform:t.platform,webSiteType:t.webSiteType,gameCode:t.gameCode,playerId:t.playerId,platformTxId:t.platformTxId,roundId:t.roundId,reverseBPColor:"false",currency:a},success:function(e){e.error?alert(e.error):(t.replayUrl=e.path,PageConfig.isMobile?GameHallUtils.isBS()?(JCache.get("#popframe").attr("src",t.replayUrl),JCache.get("#popTitle").text(I18N.get("player.report.outstanding.replay")),JCache.get("body").addClass("body-report-iframe"),JCache.get("body").addClass("body-iframe"),PopupUtil.openModal("#pop_inpage")):($j("#popframe").attr("src",t.replayUrl).parent().show(),$j("#popTitle").text(I18N.get("player.report.outstanding.replay")),$j("#gameHallHeader").hide(),$j("#gameMenuTab").hide(),$j("#gameHallDiv").hide()):t.replayUrl&&window.open(t.replayUrl))},loadingMask:"#loading"})},RankRecordEntranceHandler.playGame=function(e){PageConfig.isOpenFromRankRecordEntrance=!0,WindowEventUtil.stopEvent(event,!0,!0),PageConfig.isMobile?GameHallHandler.play(e,!1,!0):GameHallHandler.play(e,!0),PageConfig.isOpenFromRankRecordEntrance=!1}}();