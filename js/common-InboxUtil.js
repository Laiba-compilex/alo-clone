"undefined"==typeof InboxUtils&&(InboxUtils={}),function(){InboxUtils.bind=function(){JCache.get("#announceCloseBtn, #popAnnouncementMask").click(InboxUtils.closeAnnounce)},InboxUtils.init=function(e){InboxUtils.getUnreadInboxCount(),InboxUtils.getAnnouncement(e),$j("#modal-announcement").on("closeModal",function(){PopupUtil.removePopup($j("#modal-announcement").attr("id"))})};let e={isAnnounceNeeded:!1,isMaintainNeeded:!1,isMobile:!1};function n(e){if(!(e.length<=0)){var n=0,o=JCache.get("#announceContent");o.empty(),e.forEach(function(e){n++;var t=JCache.get("#announceTemplate").clone();t.attr("id",e.id),t.addClass("announce"),t.find("span").text(e.title),e.imageUrl&&(t.find("img").show(),t.find("img").attr("src",e.imageUrl),t.find("a").show()),e.content&&(t.find("p").html(e.content),t.find("p").show(),t.find("div").show()),o.append(t)}),$j("#openInbox").click(function(){InboxUtils.closeAnnounce(),"undefined"!=typeof GameHallUtils&&(GameHallUtils.isRWD()||GameHallUtils.isBS())?GameHallHandler.openMenuIframe(this):PageConfig.isMobile?(JCache.get("#popframe").attr("scrollY",window.scrollY.toString()),JCache.get("#popframe").attr("src",$j(this).attr("path")),JCache.get("#popTitle").text($j(this).find("#title").html()||$j(this).attr("value")),JCache.get("body").addClass("body-report-iframe"),JCache.get("body").addClass("body-iframe"),PopupUtil.openModal("#pop_inpage")):PopupUtil.openIframe($j(this).attr("path"))}),n>0&&(PopupUtil.closeModal("#popAnnouncement"),PopupUtil.closeModal("#popAnnouncementMask"),JCache.get("#popupMask").addClass("show"),PopupUtil.openModal("#modal-announcement"),PopupUtil.pushPopupMap($j("#modal-announcement").attr("id"),$j("#modal-announcement")))}}function o(e){var n=0,o=JCache.get("#maintenanceUl");o.empty(),e.forEach(function(e){n++;var t=JCache.get("#maintenanceTemplate").clone();t.attr("id",e.id),t.addClass("maintenance"),t.find("a").html(e.content),t.find("a").click(function(){if(PageConfig.isMobile||"undefined"!=typeof GameHallUtils&&GameHallUtils.isRWD()){let n=$j(this).attr("path");n.includes("?currentInboxId=")||$j(this).attr("path",n+"?currentInboxId="+e.id),0==$j(this).find("#title").length&&$j(this).append($j('<span id="title" style="display:none">'+I18N.get("gamehall.footer.menu.message")+"</span>")),PageConfig.isFromAgentMobileProfile?window.open($j(this).attr("path")):GameHallHandler.openMenuIframe(this)}else PopupUtil.openIframe($j(this).attr("path")+"?currentInboxId="+e.id)}),o.append(t)}),o.attr("id",""),n>0&&JCache.get("#maintenanceArea").show()}function t(e){$j.ajax({type:"POST",url:PageConfig.deleteInboxUrl,data:{inboxIds:e},success:function(n){if(n.error)alert(n.error);else{e.split(",").forEach(function(e){$j("#"+e).remove()}),InboxUtils.refreshInboxTab(),InboxUtils.closeInboxContent();var o=JCache.get("#inboxUl");if(!$j(o).find("li:visible").length)$j(o).find("li").show(),JCache.get("#inboxTabUl").find("li").removeClass("active");window.opener?window.opener.InboxUtils.getUnreadInboxCount():parent.InboxUtils.getUnreadInboxCount()}},error:function(e,n,o){}})}InboxUtils.getAnnouncement=function(t){let i=Object.assign({},e,t);postAjax({url:PageConfig.getAnnouncement,type:"POST",dataType:"json",async:!1,data:{isAnnounceNeeded:i.isAnnounceNeeded,isMaintainNeeded:i.isMaintainNeeded},success:function(e){if(i.isAnnounceNeeded&&n(JSON.parse(e.announceInfo)),i.isMaintainNeeded){o(JSON.parse(e.maintainInfo));let n=JCache.get("#maintenanceUl");"NWCASINO"===PageConfig.brandName&&JSON.parse(e.maintainInfo).length<=0&&n.append(I18N.get("gamehall.text.welcome.NWCASINO")),$j(".marquee").width()>0&&$j(".marquee").marquee({speed:100,gap:200,delayBeforeStart:0,direction:"left",duplicated:!1}).mouseover(function(){$j(this).marquee("pause")}).mouseout(function(){$j(this).marquee("resume")})}},error:function(e,n,o){}})},InboxUtils.getAnnounce=function(){$j.ajax({type:"POST",url:PageConfig.getAnnounceUrl,success:function(e){e.error?alert(e.error):e&&n(e)},error:function(e,n,o){}})},InboxUtils.getLoginAnnounce=function(){$j.ajax({type:"POST",url:PageConfig.getLoginAnnounceUrl,success:function(e){e.error?alert(e.error):e&&n(e)},error:function(e,n,o){}})},InboxUtils.getMaintenance=function(e){$j.ajax({type:"POST",url:PageConfig.getMaintenanceUrl,async:!1,success:function(n){n.error?alert(n.error):n&&o(n),$j(".marquee").width()>0&&$j(".marquee").marquee({speed:e?45:55,gap:200,delayBeforeStart:0,direction:"left",duplicated:!1}).mouseover(function(){$j(this).marquee("pause")}).mouseout(function(){$j(this).marquee("resume")})},error:function(e,n,o){}})},InboxUtils.closeAnnounce=function(){PopupUtil.closeModal("#popAnnouncement"),JCache.get("#popupMask").removeClass("show"),PopupUtil.closeModal("#modal-announcement"),$j("#modal-announcement").trigger("closeModal"),$j("#dont-show").prop("checked")&&InboxUtils.updateAccountNotShowRule()},InboxUtils.closeLoginAnnounce=function(){JCache.get("#popupMask").removeClass("show"),"true"===PageConfig.isShowTNCAfterAnnounce&&GameHallUtils.openFooterIframe("Terms"),PopupUtil.closeModal("#modal-announcement"),$j("#modal-announcement").trigger("closeModal")},InboxUtils.readLoginAnnounce=function(){JCache.get("#popupMask").removeClass("show"),PopupUtil.closeModal("#modal-announcement"),$j("#modal-announcement").trigger("closeModal"),"true"===PageConfig.isShowTNCAfterAnnounce&&GameHallUtils.openFooterIframe("Terms"),$j("#dont-show").prop("checked")&&InboxUtils.setReadAnnounceCookie()},InboxUtils.updateAccountNotShowRule=function(){$j.ajax({type:"POST",url:PageConfig.updateAccountNotShowRuleUrl,success:function(e){e.error&&alert(e.error)},error:function(e,n,o){alert("error when updateAccountNotShowRule")}})},InboxUtils.setReadAnnounceCookie=function(){$j.ajax({type:"POST",url:PageConfig.setReadAnnounceCookie,success:function(e){e.error&&alert(e.error)},error:function(e,n,o){alert("error when setReadAnnounceCookie")}})},InboxUtils.updateInboxToRead=function(e){$j.ajax({type:"POST",url:PageConfig.updateInboxUrl,data:{inboxIds:e},success:function(e){e.error&&alert(e.error)},error:function(e,n,o){alert("error when updateInboxToRead")}})},InboxUtils.getUnreadInboxCount=function(){$j("#inboxUnreadCount").hide(),$j.ajax({type:"POST",url:PageConfig.getUnreadInboxCountUrl,success:function(e){if(e.error)alert(e.error);else if(e){let n=e;$j("#inboxUnreadCount").text(n>99?"99":n),$j("#inboxUnreadCount").show(),$j("#menu_dot, #mail_dot").toggle(n>0),$j("#mail_dot").data("count",n)}},error:function(e,n,o){}})},InboxUtils.getInbox=function(){var e=PageConfig.isMobile?"mobile":"desktop";document.documentElement.classList.add(e),$j.ajax({type:"POST",url:PageConfig.getInboxUrl,success:function(e){if(e.error)alert(e.error);else if(e&&(function(e){var n=JCache.get("#inboxUl");n.empty(),0!=e.length?($j(".empty-mail").hide(),n.parent().removeClass("empty-list")):n.hide();e.forEach(function(e){var o=JCache.get("#inboxTemplate").clone();o.attr("id",e.id),o.addClass(e.inboxType),e.read&&o.addClass("inbox-read"),$j(o).find(".tumbSubject").text(e.title);var t=e.createTime.substring(0,10),i=e.createTime,a=new Date(e.createTime);isNaN(a.getTime())||(t=a.toLocaleDateString(),i=a.toLocaleString()),$j(o).find(".time").text(t).attr("title",i),n.append(o)}),InboxUtils.refreshInboxTab()}(e),PageConfig.currentInboxId)){var n=$j("#"+PageConfig.currentInboxId);InboxUtils.getInboxContent(n)}},error:function(e,n,o){},complete:function(){PageConfig.currentTab&&""!=PageConfig.currentTab&&$j("#"+PageConfig.currentTab).click()}})},InboxUtils.refreshInboxTab=function(){var e=[];$j.each($j("#inboxTabUl").find("li"),function(n,o){e.push(o.id)}),$j(".inbox-num").hide();for(var n=0;n<e.length;n++){var o=e[n],t=0;$j.each($j("."+o),function(e,n){$j(n).hasClass("inbox-read")||t++}),t&&($j("#"+o+"_UNREAD_NUM").show(),$j("#"+o+"_UNREAD_NUM").text(t)),"PERSONAL"==o&&0==$j("."+o).length&&($j(".inbox-tool").hide(),$j(".inbox-checkbox").hide(),$j("#inboxDeleteBtn").hide())}},InboxUtils.switchInboxTab=function(e){$j(".inbox-tool").hide(),$j(".inbox-checkbox").hide(),$j("#inboxDeleteBtn").hide(),JCache.get("#inboxTabUl").find("li").removeClass("active"),$j(e).addClass("active");var n=JCache.get("#inboxUl");n.find("li").hide(),$j(n).find("."+e.id).show(),$j(".empty-mail").toggle(0==$j(n).find("."+e.id).length),n.toggle(0!=$j(n).find("."+e.id).length),n.parent().toggleClass("empty-list",0==$j(n).find("."+e.id).length),InboxUtils.closeInboxContent(),"PERSONAL"==e.id&&0!=$j(n).find("."+e.id).length&&($j(n).find("."+e.id).find(".inbox-checkbox").show(),$j(".inbox-tool").show(),$j(".inbox-tool").find(".inbox-checkbox").show())},InboxUtils.selectAllInbox=function(e){$j(".inbox-checkbox-input:visible").prop("checked",$j(e).is(":checked")),$j("li").removeClass("inbox-list-select"),$j(".inbox-checkbox-input:visible:not('#selAllInbox'):checked").closest("li").addClass("inbox-list-select")},InboxUtils.checkSelectAllInboxAndToggleClass=function(e){$j("#selAllInbox").prop("checked",0==$j(".inbox-checkbox-input:visible:not(:checked):not('#selAllInbox')").length),$j(e).closest("li").toggleClass("inbox-list-select",$j(e).is(":checked"))},InboxUtils.getInboxContent=function(e){$j(e).data("content")?InboxUtils.showInboxContent(e):$j.ajax({type:"POST",url:PageConfig.getInboxContentUrl,data:{id:$j(e).attr("id"),isInbox:$j(e).hasClass("PERSONAL")},success:function(n){n.error?alert(n.error):n&&($j(e).data("content",n),InboxUtils.showInboxContent(e))},error:function(e,n,o){}})},InboxUtils.showInboxContent=function(e){var n=$j(e),o=n.data("content");$j("#inboxDeleteBtn").hide(),PageConfig.isMobile&&$j(".inbox-wrap").addClass("inbox-open"),$j("li").removeClass("inbox-list-preview"),n.addClass("inbox-list-preview");var i=JCache.get("#inboxContentDiv");!function(e){e.find("#inboxContent").text(""),e.find("img").hide(),$j(e).find("#inboxCreator").text(""),$j(e).find("#inboxTitle").text(""),$j(e).find("#inboxDeleteBtn").unbind("click")}(i),i.find("#time").html(n.find(".time").attr("title")),i.find("#inboxContent").html(o.content),null!=o.announceImageUrl&&(i.find("img").show(),i.find("img").attr("src",o.announceImageUrl)),i.find("#inboxTitle").text(n.find(".tumbSubject").text()),n.hasClass("PERSONAL")&&(i.find("#inboxDeleteBtn").bind("click",function(){t(n.attr("id")),InboxUtils.back()}),$j("#inboxDeleteBtn").show()),n.hasClass("inbox-read")||(InboxUtils.updateInboxToRead(n.attr("id")),n.addClass("inbox-read"),window.opener?window.opener.InboxUtils.refreshInboxUnreadCount(1):parent.InboxUtils.refreshInboxUnreadCount(1),InboxUtils.refreshInboxTab()),JCache.get("#inboxEmptyDiv").hide(),JCache.get("#inboxContentDiv").show()},InboxUtils.refreshInboxUnreadCount=function(e){$j("#inboxUnreadCount").text()-e>0?$j("#inboxUnreadCount").text($j("#inboxUnreadCount").text()-e):$j("#inboxUnreadCount").hide();let n=$j("#mail_dot").data("count")-e;$j("#menu_dot, #mail_dot").toggle(n>0)},InboxUtils.closeInboxContent=function(){$j(".inbox-checkbox-input").prop("checked",!1),$j("li").removeClass("inbox-list-select"),$j("#inboxContentDiv").hide(),$j("#inboxEmptyDiv").show(),$j("li").removeClass("inbox-list-preview")},InboxUtils.back=function(){PageConfig.isMobile&&($j(".inbox-wrap").hasClass("inbox-open")?$j(".inbox-wrap").removeClass("inbox-open"):parent.closePopframe())},InboxUtils.deleteAllSelInbox=function(){t($j(".inbox-checkbox-input:visible:not('#selAllInbox'):checked").closest("li").map(function(){return $j(this).attr("id")}).toArray().toString()),$j("#selAllInbox").prop("checked",!1)}}();