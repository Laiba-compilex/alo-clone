"undefined"==typeof BonusEventPresentHandler&&(BonusEventPresentHandler={}),function(){let e,t=!1,i={gameTagId:"treasureBonusEventTag",buildResultArea:function(){throw"buildResultArea must promise"},beforeAjax:function(){return new Promise(e=>{e()})},takeTicketProcess:function(e,t,i){return new Promise(e=>{e()})},playMiniGame:function(e,t,i){return new Promise(e=>{e()})},takeTicketResult:function(e,t,i){throw"takeTicketResult must promise"},afterAjax:function(e){return new Promise(e=>{e()})},ajaxError:function(e,t){return new Promise(e=>{e()})},onCloseFancyAlert:function(e){return new Promise(e=>{e()})}};function a(e){return Object.assign({},i,e)}function n(e){let t="";return e>=10&&(t=e>=100?"award-1":"award-2"),t}BonusEventPresentHandler.REBATE=a({buildResultArea:function(e,t,i){return new Promise(e=>{$j(i).find("#ticketArea").remove(),e()})},takeTicketResult:function(e,t,i){return new Promise(e=>{if(t.length>0){let e=2e3,i=0,a=0;for(let e of t)i=MathUtil.decimal.add(i,parseFloat(e.award)),a++;if(a>0){let n=t[0],s={bonusAmt:i,freeSpinAmt:0,bonusId:n.bonusId,ticketCount:a,platform:n.platform,promiseDelay:e};showAutoRedeemResult(s)}}e()})},takeTicketProcess:function(e,t,i){},afterAjax:function(e){return new Promise(e=>{BonusEventHandler.takeTicketLock=!1,e()})},onCloseFancyAlert:function(t){return new Promise(t=>{BonusEventHandler.takeTicketLock=!1,clearTimeout(e),t()})},templateId:"",className:"auto_redeem",dataClear:"/theme/media/music/challengeResult.mp3",dataRewardspin:"",dataRewardswift:"",gameTagId:"rebateTag"}),BonusEventPresentHandler.MARIOSLOT=a({buildResultArea:function(e,t,i){return new Promise(a=>{let s=t.safeSelector("#rankRewardEffect").cloneNode(!0);i.insertBefore(s,i.firstChild);let o="{}"!=e.miniGamePrizeDistribution+"",l=t.safeSelector("#miniSlotTemplateStage").cloneNode(!0);o||(l.style.display="none"),i.insertBefore(l,i.firstChild);let r=t.safeSelector("#roll-button").cloneNode(!0);r.setAttribute("onclick","GameHallHandler.openLoginPopup(this)"),r.setAttribute("bonusId",e.bonusId),i.safeSelector(".txt-ticket-all").remove(),i.insertBefore(r,i.firstChild);let c=t.safeSelector("#"+this.templateId).cloneNode(!0),d=e.prizes.split(","),u=JSON.parse(e.miniGamePrizeDistribution);if(u.hasOwnProperty("extra")){let e=Object.keys(u.extra);d=d.filter(function(t){return!e.includes(t)})}let m=d.sort(function(e,t){var i=e.split(" "),a=t.split(" ");return i[0].localeCompare(a[0],void 0,{numeric:!0})}),p=new Map,g=m.length;m.forEach(e=>{p.set(e,g--)});let f=0;for(let i=0;i<parseInt(e.presentPrizeNum);i++){let a,s,l=t.safeSelector("#marioSlotTemplate").cloneNode(!0);i==PageConfig.marioSlotChanceIndex&&o?(a="chance",s="?"):i%2!=0?(a=p.get(m[0]),s=m[0],m.length>=10&&m.length-f-1>=parseInt(e.presentPrizeNum)-i-1?(a=p.get(m[f]),s=m[f],f++):(a=p.get(m[0]),s=m[0])):(f%m.length==0&&f++,a=p.get(m[f%m.length]),s=m[f%m.length],f++),l.className="bonus-btn Awards-"+a;let r=l.safeSelector(".award-role");if(r.src=PageConfig.imagePrefix+"/theme/images/src-common/BONUSEVENT-img/MARIO/awards/award-"+a+".webp",r.class="award-role Awards-"+a,1==s.split(" ").length)l.safeSelector(".txt-number").textContent=s;else{let t=MathUtil.decimal.multiply(MathUtil.decimal.multiply(e.freeSpinSetting[s].baseAmt,e.freeSpinSetting[s].multiplier),parseInt(e.freeSpinGameLines)),i=(n(t),MathUtil.decimal.multiply(t,parseInt(s.split(" ")[0])));l.innerHTML=`<div class="freeSpinTag ${PageConfig.freeSpinTagClass}" href="javascript:void(0)" style="">\n\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/FREESPIN/freeSpinTag_${PageConfig.freeSpinTagClass.toLowerCase()}.webp" alt="freeSpinTag">\n\t\t\t\t\t\t\t<div class="txt-balance ${PageConfig.chosenCurrency}">${i}</div>\n\t\t\t\t\t\t</div>`}l.id="marioSlotRoad-"+i,l.setAttribute("award_num",a),c.classList.add("run-3"),c.appendChild(l)}i.insertBefore(c,i.firstChild),a()})},toggleClasses:function(e){e.classList.toggle("odd-roll"),e.classList.toggle("even-roll")},genBoard:function(e){return e<5?{translateX:74*e,translateY:0}:e<9?{translateX:296,translateY:74*(e-4)}:e<13?{translateX:296-74*(e-8),translateY:296}:{translateX:0,translateY:296-74*(e-12)}},getRandomNumber:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},onCloseFancyAlert:function(t){return new Promise(i=>{t[0].querySelectorAll(".bonus-btn").forEach(function(e){e.className=e.className.replace(/pass-\d+\s*/g,""),e.offsetWidth}),t[0].safeSelector("#marioSlotRoad-"+PageConfig.marioSlotChanceIndex).classList.remove("active"),t[0].safeSelector("#miniSlotTemplateStage").classList.remove("active"),BonusEventHandler.takeTicketLock=!1,clearTimeout(e),i()})},gameTagId:"marioSlotBonusEventTag",templateId:"marioSlotPresentTemplate",dataSwift:"/theme/media/music/marioSlotSwift.mp3",dataLoading:"/theme/media/music/marioSlotLoading.mp3",dataSpin:"/theme/media/music/miniSlotLoading.mp3",dataClear:"/theme/media/music/marioSlotClear.mp3",className:"page-bonus-MARIOSLOT",dataRewardspin:"/theme/media/music/miniMinerBomb.mp3",dataRewardswift:"/theme/media/music/miniMinerBurn.mp3"}),BonusEventPresentHandler.AUTO_REDEEM=a({buildResultArea:function(e,t,i){return new Promise(e=>{$j(i).find("#ticketArea").remove(),e()})},templateId:"",className:"auto_redeem",dataClear:"/theme/media/music/challengeResult.mp3",dataRewardspin:"",dataRewardswift:"",gameTagId:"autoRedeemBonusEventTag"}),BonusEventPresentHandler.TREASURE_PICK=a({buildResultArea:function(e,t,i){return new Promise(a=>{let n=t.safeSelector("#"+this.templateId).cloneNode(!0);n.classList.add("num-"+e.presentPrizeNum);for(let i=0;i<parseInt(e.presentPrizeNum);i++){let a=t.safeSelector("#boxTemplate").cloneNode(!0);a.setAttribute("id","box"+i),a.setAttribute("onclick","GameHallHandler.openLoginPopup(this)"),a.setAttribute("bonusId",e.bonusId),a.safeSelector("#ticketAmtWrapper").setAttribute("id","ticketAmtWrapper"+i);let s=a.safeSelector("#freeSpinBoxResult");s.setAttribute("id","freeSpinBoxResult"+i),s.classList.add(PageConfig.freeSpinTagClass),n.appendChild(a)}i.insertBefore(n,i.firstChild),a()})},templateId:"treasurePickPresentTemplate",className:"multi-event",dataClear:"/theme/media/music/openBox.mp3",dataRewardspin:"/theme/media/music/miniSlotLoading.mp3",dataRewardswift:"/theme/media/music/lightSwift.mp3"}),BonusEventPresentHandler.GOLDEN_EGG=a({buildResultArea:function(e,t,i){return new Promise(t=>{let a=e.skinName,n=`GOLDENEGG/${a.toUpperCase()}`,s=NumberFormatUtil.formatNumber(e.ticketMinValue,2),o=NumberFormatUtil.formatNumber(e.ticketMaxValue,2),l=NumberFormatUtil.formatNumber(MathUtil.decimal.multiply(e.ticketMinValue,10),2),r=NumberFormatUtil.formatNumber(MathUtil.decimal.multiply(e.ticketMaxValue,10),2),c=NumberFormatUtil.formatNumber(MathUtil.decimal.multiply(e.ticketMinValue,100),2),d=NumberFormatUtil.formatNumber(MathUtil.decimal.multiply(e.ticketMaxValue,100),2),u=`<div class="${a}-box" >\n\t\t\t\t\t<div class="container">\n\t\t\t\t\t\t<div class="swiper swiper-carousel swiper-${a}">\n\t\t\t\t\t\t\t<div class="swiper-wrapper">\n\t\t\t\t\t\t\t\t<div class="swiper-slide item ${a}-item copper${a} disable" eggType="copper"  id="copperEgg" \n\t\t\t\t\t\t\t\t\tbonusId="${e.bonusId}" onclick="GameHallHandler.openLoginPopup(this)">\n\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/copper.webp" class="${a}">\n\t\t\t\t\t\t\t\t\t<div class="txt-redeem">\n\t\t\t\t\t\t\t\t\t\t<p>redeem</p>\n\t\t\t\t\t\t\t\t\t\t<div class="txt-ticket">\n\t\t\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/gold${a}-ticket.webp" class="ticket">\n\t\t\t\t\t\t\t\t\t\t\t<span>×1</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="txt-rage"  id="copperRange">\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${s}</div>~\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${o}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="swiper-slide item ${a}-item silver${a} disable" eggType="silver" id="silverEgg" \n\t\t\t\t\t\t\t\t\tbonusId="${e.bonusId}" onclick="GameHallHandler.openLoginPopup(this)">\n\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/silver.webp" class="${a}">\n\t\t\t\t\t\t\t\t\t<div class="txt-redeem">\n\t\t\t\t\t\t\t\t\t\t<p>redeem</p>\n\t\t\t\t\t\t\t\t\t\t<div class="txt-ticket">\n\t\t\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/gold${a}-ticket.webp" class="ticket">\n\t\t\t\t\t\t\t\t\t\t\t<span>×10</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="txt-rage" id="silverRange">\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${l}</div>~\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${r}</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="swiper-slide item ${a}-item gold${a} disable"  id="goldEgg" \n\t\t\t\t\t\t\t\t\tbonusId="${e.bonusId}" onclick="GameHallHandler.openLoginPopup(this)" eggType="gold">\n\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/gold.webp" class="${a}">\n\t\t\t\t\t\t\t\t\t<div class="txt-redeem">\n\t\t\t\t\t\t\t\t\t\t<p>redeem</p>\n\t\t\t\t\t\t\t\t\t\t<div class="txt-ticket">\n\t\t\t\t\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/${n}/gold${a}-ticket.webp" class="ticket">\n\t\t\t\t\t\t\t\t\t\t\t<span>×100</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="txt-rage" id="goldRange">\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${c}</div>~\n\t\t\t\t\t\t\t\t\t\t<div class="txt-bonus ${PageConfig.chosenCurrency}">${d}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="swiper-button-next"></div>\n\t\t\t\t\t\t\t<div class="swiper-button-prev"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;i.innerHTML=u,t()})},className:"goldenEgg",dataClear:"/theme/media/music/goldenEgg.mp3",spinMusic:"/theme/media/music/goldenEggSpin.mp3",gameTagId:{egg:"goldenEggBonusEventTag",box:"goldenBoxBonusEventTag"}}),BonusEventPresentHandler.ROULETTE=a({isRotating:!1,buildResultArea:function(e,t,i){return new Promise(a=>{let n=t.safeSelector("#rankRewardEffect").cloneNode(!0);i.insertBefore(n,i.firstChild);let s="{}"!=e.miniGamePrizeDistribution+"",o=t.safeSelector("#miniSlotTemplateStage").cloneNode(!0);s||(o.style.display="none"),i.insertBefore(o,i.firstChild);let l=t.safeSelector("#"+this.templateId).cloneNode(!0);l.setAttribute("id",""),l.safeSelector("#rouletteButton").setAttribute("bonusId",e.bonusId);let r=e.prizes.split(","),c=JSON.parse(e.miniGamePrizeDistribution);if(c.hasOwnProperty("extra")){let e=Object.keys(c.extra);r=r.filter(function(t){return!e.includes(t)})}let d=l.safeSelector("#rouletteWrapper");if(r.forEach(function(i,a){let n=t.safeSelector("#rouletteRow").cloneNode(!0);if(1==i.split(" ").length)n.innerHTML='<div class="txt">'+NumberFormatUtil.formatNumber(i,0)+"</div>",n.setAttribute("id","rouletteRow_"+i);else{let t=MathUtil.decimal.multiply(MathUtil.decimal.multiply(e.freeSpinSetting[i].baseAmt,e.freeSpinSetting[i].multiplier),parseInt(e.freeSpinGameLines)),a=MathUtil.decimal.multiply(t,parseInt(i.split(" ")[0],10));n.innerHTML=`<div class="freeSpinTag ${PageConfig.freeSpinTagClass}" href="javascript:void(0)" style="">\n\t\t\t\t\t\t\t<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/FREESPIN/freeSpinTag_${PageConfig.freeSpinTagClass.toLowerCase()}.webp" alt="freeSpinTag">\n\t\t\t\t\t\t\t<div class="txt-balance ${PageConfig.chosenCurrency}">${a}</div>\n\t\t\t\t\t\t</div>`,n.setAttribute("id","rouletteRow_"+i.split(" ")[0])}d.appendChild(n)}),s){let e=t.safeSelector("#rouletteRow").cloneNode(!0);e.innerHTML='<span class="txt-bonus chance">\n\t\t\t\t\t\t\t  <img class="chance" src="'+PageConfig.imagePrefix+'/theme/images/src-common/BONUSEVENT-img/ROULETTE/bonus-chance.webp">\n\t\t\t\t\t\t</span>',e.setAttribute("id","rouletteRow_chance"),d.insertBefore(e,d.firstChild),d.classList.add("num-"+(r.length+1))}else d.classList.add("num-"+r.length);d.insertAdjacentHTML("beforeend",'<img class="roulette-box" src="'+PageConfig.imagePrefix+'/theme/images/src-common/BONUSEVENT-img/ROULETTE/roulette-box.webp" alt="">'),i.insertBefore(l,i.firstChild),a()})},templateId:"roulettePresentTemplate",className:"page-bonus-Roulette",dataLoading:"/theme/media/music/rotateRoulette-loading.mp3",dataClear:"/theme/media/music/rotateRoulette-clear.mp3",dataSpin:"/theme/media/music/miniSlotLoading.mp3",dataRewardspin:"/theme/media/music/miniSlotLoading.mp3",dataRewardswift:"/theme/media/music/lightSwift.mp3",gameTagId:"rouletteBonusEventTag"}),BonusEventPresentHandler.RAFFLE=a({buildResultArea:function(e,t,i){return new Promise(a=>{let n=t.safeSelector("#"+this.templateId).cloneNode(!0);n.setAttribute("id","");let s=t.safeSelector("#raffleBonusTemplate").cloneNode(!0);s.setAttribute("id","");for(let i=0;i<parseInt(e.presentPrizeNum);i++){let a=t.safeSelector("#raffleBoxTemplate").cloneNode(!0);if(a.setAttribute("id","box"+i),a.setAttribute("onclick","GameHallHandler.openLoginPopup(this)"),a.setAttribute("bonusId",e.bonusId),n.appendChild(a),3==i){let e=t.safeSelector("#raffleBoxTemplate").cloneNode(!0);e.setAttribute("id","middleBox"),n.appendChild(e),e.safeSelector(".bonus-question").remove(),e.safeSelector(".bonus-take").remove(),e.safeSelector(".hole").remove(),e.safeSelector(".bonus-win-gold").remove()}}let o=e.prizes.split(","),l=0,r=e.platform;o.forEach(function(e){l++;let i=t.safeSelector("#raffleBtnTemplate").cloneNode(!0),a="Awards-"+l;i.setAttribute("id",a),i.classList.add(a),i.classList.add(e.split(" ")[0]),i.safeSelector(".txt-number").textContent=e;let n=document.createElement("img");n.alt="",n.src=PageConfig.imagePrefix+"/theme/images/src-common/BONUSEVENT-img/RAFFLE/tournament/"+r+"/"+a+".webp",i.appendChild(n),s.appendChild(i)}),i.insertBefore(n,i.lastChild),i.insertBefore(s,i.lastChild),a()})},templateId:"rafflePickPresentTemplate",className:"multi-event Raffle",gameTagId:"raffleBonusEventTag",dataClear:"/theme/media/music/rotateRoulette-clear.mp3"}),BonusEventPresentHandler.RAFFLE_MULTI=a({buildResultArea:function(e,t,i){return new Promise(a=>{let n=t.safeSelector("#"+this.templateId).cloneNode(!0);n.setAttribute("id",""),n.safeSelector(".raffle-table").remove();let s=t.safeSelector("#raffleBonusTemplate").cloneNode(!0);s.setAttribute("id","");for(let i=0;i<parseInt(e.presentPrizeNum);i++){let a=t.safeSelector("#raffleMultiBoxTemplate").cloneNode(!0);a.setAttribute("id","box"+i),a.setAttribute("bonusId",e.bonusId),a.setAttribute("onclick","GameHallHandler.openLoginPopup(this)"),n.appendChild(a)}let o=t.safeSelector("#raffleMultiRefreshBtnTemplate").cloneNode(!0);o.setAttribute("id",""),o.setAttribute("bonusId",e.bonusId),o.setAttribute("onclick","GameHallHandler.openLoginPopup(this)"),n.insertBefore(o,n.safeSelector("#box12"));let l=e.prizes.split(","),r=0,c=e.platform;l.forEach(function(e){r++;let i=t.safeSelector("#raffleBtnTemplate").cloneNode(!0),a="Awards-"+r;i.setAttribute("id",a),i.classList.add(a),i.classList.add(e.replace(" ","")),i.safeSelector(".txt-number").textContent=e;let n=document.createElement("img");n.alt="",n.src=PageConfig.imagePrefix+"/theme/images/src-common/BONUSEVENT-img/RAFFLE/tournament/"+c+"/"+a+".webp",i.appendChild(n),s.appendChild(i)}),i.insertBefore(n,i.lastChild),i.insertBefore(s,i.lastChild),a()})},checkedPrizeList:new Array,gameTagId:"raffleBonusEventTag",templateId:"rafflePickPresentTemplate",className:"multi-event Raffle-multi turn-card",dataLoading:"/theme/media/music/raffleMulti_100ms.mp3"}),BonusEventPresentHandler.SIGNUP=a({buildResultArea:function(e,t,i){return new Promise(t=>{let a=i.safeSelector("#signupBox");a.setAttribute("bonusid",e.bonusId),a.addEventListener("click",function(){BonusEventHandler.takeTicket(this,!1,1)}),t()})},templateId:"signupPresentTemplate",className:"signupEventBonus-page",dataClear:"/theme/media/music/openBox.mp3",gameTagId:"signupBonusEventTag"}),BonusEventPresentHandler.DAILY_MISSION=a({buildResultArea:function(e,t,i){return new Promise(t=>{for(const t of e){let e=$j(i).find(`#PageDiv${t.bonusId}`)[0];const a=this,n=t.bonusDailyMissionMap,s=parseInt(e.dataset.now),o=e.closest(".page-bonus-div");let l=DateUtil.getLocalDate(t.endDate+":00:00"),r=!1;l.setDate(l.getDate()-1),DateUtil.getPrevSettleTime().getTime()>l.getTime()&&(r=!0),Object.keys(n).forEach((i,a)=>{let o=n[i],l=a+1,c=document.getElementById("calendarItemTemplate").content.cloneNode(!0),d=c.querySelector(".calendar-num"),u=o.future,m=(o.expired,o.now),p=c.querySelector("li"),g=p.querySelector("#calendarReward");if(p.dataset.day=l,p.id="calendar_"+o.missionDateStr,u){p.classList.add("future");let e=document.createElement("img");e.alt="",e.src=PageConfig.imagePrefix+"/theme/images/src-common/BONUSEVENT-img/DAILYCHECKIN/dailyCheckIn-question.webp",g.appendChild(e)}else m?p.classList.add("today"):p.classList.add("past");d.textContent=l,p.onclick=function(){e.querySelectorAll('[id^="taskContent_"]').forEach(function(t){let i=t.dataset.ticketDate;parseInt(t.dataset.day)===l?(t.style.display="",e.querySelector("#calendar_"+i).classList.add("on"),s!=l||r?(e.querySelector("#todayMissionRemainingTime").style.display="none",e.querySelector("#dailyTitleText").textContent=I18N.get("dailyTask"),e.querySelector("#expiredSpan").style.display=s>l||r?"":"none"):(e.querySelector("#todayMissionRemainingTime").style.display="",e.querySelector("#dailyTitleText").textContent=I18N.get("todayTask"),e.querySelector("#expiredSpan").style.display="none")):(t.style.display="none",e.querySelector("#calendar_"+i).classList.remove("on"))})},e.querySelector("#bonusEventResultWrapper").append(p);let f=e.querySelector("#missionBox"),S=document.getElementById("dailyMissionTemplate").content.cloneNode(!0);if(S.querySelector("#dailyMissionContent").dataset.day=l,S.querySelector("#dailyMissionContent").dataset.ticketDate=o.missionDateStr,S.querySelector("#dailyMissionContent").id="taskContent_"+o.missionDateStr,u){let e=document.getElementById("missionTemplate").content.cloneNode(!0);e.querySelector("li").innerHTML='<span class="task-txt">( Coming soon )</span>',S.querySelector("#missionList").append(e)}else o.missionList.forEach(function(e,i){if("TURNOVER_REQUIRE_CHALLENGE"===e.action)return;let a=o.missionList.length>1?++i+". ":"",n=document.getElementById("missionTemplate").content.cloneNode(!0);s==l&&(S.querySelector(".task-item").style.display=""),n.querySelector("li").id=e.action,n.querySelector("#targetValue").textContent=e.atLeast,PageConfig.CHECK_IN==e.action&&t.isOnlyApp&&!PageConfig.isIOS?n.querySelector("#missionDesc").textContent=a+I18N.get("player.bonusEvent.missionType.appCheckin"):n.querySelector("#missionDesc").textContent=a+I18N.get(e.description),PageConfig.BET_TIMES!=e.action&&PageConfig.TURNOVER_REQUIRED!=e.action||(n.querySelector("#requiredGameListButton").style.display="",n.querySelector("#requiredGameListButton").addEventListener("click",function(){PopupUtil.openModal(`#${t.bonusId}GameList`)})),PageConfig.DEPOSIT_AMOUNT!=e.action&&PageConfig.DEPOSIT_COUNT!=e.action||!PageConfig.isAllowBanking||(n.querySelector("#bankingDepositDispatchButton").style.display=""),S.querySelector("#missionList").append(n)});f.append(S)});let c=e.closest(".page-bonus-div").safeSelector("#cumulativeArea");if(t.isActiveCumulativeSetting){let i=e.safeSelector("#cumulativeArea");i.style.display="block";let a=i.safeSelector("#cumulativeBoxWrapper");t.cumulativeSetting.length>4&&a.classList.add("over-4"),t.cumulativeSetting.forEach(function(e,i){let n=document.getElementById("cumulativeBoxTemplate").content.cloneNode(!0);n.safeSelector("#treasureImg").src=`${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/DAILYCHECKIN/dailyCheckIn-treasure_lv${i+1}.webp`,n.safeSelector("#targetDays").innerHTML=`${e.cumulateDays}`;let s=n.safeSelector("#cumulativeBox");s.setAttribute("cumulativeDays",e.cumulateDays),s.setAttribute("id","cumulativeBox"+e.cumulateDays),n.safeSelector("#pointBox").setAttribute("id",t.bonusId+"_cumulative"+i),s.setAttribute("boxNum",i+1),a.appendChild(n);let o=s.safeSelector("#rewardArea");if(-1!=e.reward.indexOf("Point")){let t=document.getElementById("pointRewardTemplate").content.cloneNode(!0);t.safeSelector("#rewardPoint").innerHTML=e.reward.split(" ")[0],o.appendChild(t)}else if(-1!=e.reward.indexOf("Spin")){let t=document.getElementById("freeSpinRewardTemplate").content.cloneNode(!0);t.safeSelector("#freeSpinRewardDiv").classList.add(PageConfig.freeSpinTagClass),t.safeSelector("#freeSpinRewardImg").setAttribute("src",`${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/FREESPIN/freeSpinTag_${PageConfig.freeSpinTagClass.toLowerCase()}.webp`),t.safeSelector("#rewardFreeSpin").innerHTML=e.reward.split(" ")[0],o.appendChild(t)}else{let t=document.getElementById("moneyRewardTemplate").content.cloneNode(!0);t.safeSelector("#rewardBalance").innerHTML=e.reward,o.appendChild(t)}})}else c.remove;a.startCountDown(e.querySelector("#todayMissionRemainingTime")),o.querySelector("#dailyBackdrop").onclick=function(){let e=$j("#"+$j(this).data("taskid"));e.find("#treasureDiv").removeClass("showReward"),e.find("#cumulativeInfo").removeClass("show"),this.classList.remove("show"),$j("#dailyMissionsPageDiv .tooltipBox").removeClass("show")}}t()})},updateRewardWithImage:function(e,t,i){const a=document.createElement("img");a.alt="",a.className=i,a.src=PageConfig.imagePrefix+t,e.innerHTML="",e.appendChild(a)},applyTemplateBasedOnAmount:function(e){let t,i=e.bonusAmt,a=e.freeSpinCount,n=e.freeSpinBaseAmt,s=e.pointAmt,o=MathUtil.decimal.multiply(n,a);if(0!=n){t=document.getElementById("freespinsBoxTemplate").content.cloneNode(!0);let e=`<img src="${PageConfig.imagePrefix}/theme/images/src-common/BONUSEVENT-img/FREESPIN/freeSpinTag_${PageConfig.freeSpinTagClass.toLowerCase()}.webp" alt="freeSpinTag">\n\t\t\t\t\t\t<div class="txt-balance ${PageConfig.chosenCurrency}">${o}</div>`;t.querySelector("#freeSpinBox").innerHTML=e,t.querySelector("#freeSpinBox").classList.add(PageConfig.freeSpinTagClass)}else 0!=s?(t=document.getElementById("pointBoxTemplate").content.cloneNode(!0),t.querySelector("#pointAmt").textContent=s):(t=document.getElementById("moneyBoxTemplate").content.cloneNode(!0),t.querySelector("#bonusAmt").textContent=i);return t},updateProgressBasedOnRemark:function(e,t){$j(e).find("#missionList>li").each(function(){$j(this).find("#currentValue").text("0")})},handleRedeemableTicket:function(e,t,i,a){t.safeSelector("#treasureDiv").classList.add("done"),i.classList.add("done"),this.updateRewardWithImage(a,"/theme/images/src-common/BONUSEVENT-img/DAILYCHECKIN/dailyCheckIn-treasure-s.webp","img-treasure"),t.safeSelector("#treasureDiv").setAttribute("bonusId",e.bonusID),t.safeSelector("#treasureDiv").onclick=function(){i.safeSelector("#calendarReward").style.display="none",BonusEventHandler.takeTicket(this,!1,e.ticketID)}},handleRedeemedTicket:function(e,t,i,a){let n=this;e.undone&&(t.safeSelector("#treasureDiv").classList.add("undone"),i.classList.add("undone"),n.updateRewardWithImage(a,"/theme/images/src-common/BONUSEVENT-img/DAILYCHECKIN/dailyCheckIn-treasure_gray.webp","img-treasure"),t.safeSelector("#treasureDiv").onclick=function(){console.log("a");let e=this.classList.contains("showReward");$j("div #treasureDiv").removeClass("showReward"),e||this.classList.add("showReward")})},handleDailyMission:function(e,i){let a=this;for(const t of e){let e=i.find(`#PageDiv${t.bonusId}`),n=t.allTicketMap,s=t.todayUndoneTicket,o=DateUtil.getLocalDate(t.endDate+":00:00");o.setDate(o.getDate()-1);let l=!1,r=DateUtil.getPrevSettleTime();r.getTime()>o.getTime()&&(r=o,l=!0);let c=r.toISOString().split("T")[0],d=e.find("#calendar_"+c)[0],u=e.find("#taskContent_"+c)[0];if(e.attr("ticketCount",t.ticketCount),e.data("now")>3){let t=DateUtil.getPrevSettleTime();t.setDate(t.getDate()-3);let i=t.toISOString().split("T")[0],a=e.find("#calendar_"+i)[0].offsetLeft;e.find("#bonusEventResultWrapper")[0].scrollLeft=a}if(s){let i=DateUtil.getPrevSettleTime().toISOString().split("T")[0],n=e.find("#taskContent_"+i)[0],o=e.find("#calendar_"+i)[0],l=o.querySelector("#calendarReward"),r=n.querySelector("#taskReward");o.className="",l.innerHTML="",r.innerHTML="",n.querySelector("#missionList").innerHTML="";let c=t.bonusDailyMissionMap[i];c.missionList.forEach(function(e,i){let a=c.missionList.length>1?++i+". ":"",s=document.getElementById("missionTemplate").content.cloneNode(!0);s.querySelector("li").id=e.action,s.querySelector("#targetValue").textContent=e.atLeast,PageConfig.CHECK_IN==e.action&&t.isOnlyApp&&!PageConfig.isIOS?s.querySelector("#missionDesc").textContent=a+I18N.get("player.bonusEvent.missionType.appCheckin"):s.querySelector("#missionDesc").textContent=a+I18N.get(e.description),PageConfig.BET_TIMES!=e.action&&PageConfig.TURNOVER_REQUIRED!=e.action||(s.querySelector("#requiredGameListButton").style.display="",s.querySelector("#requiredGameListButton").addEventListener("click",function(){PopupUtil.openModal(`#${t.bonusId}GameList`)})),PageConfig.DEPOSIT_AMOUNT!=e.action&&PageConfig.DEPOSIT_COUNT!=e.action||!PageConfig.isAllowBanking||(s.querySelector("#bankingDepositDispatchButton").style.display=""),n.querySelector("#missionList").append(s)}),n.safeSelector("#treasureDiv").className="treasure undone",o.className="today undone on",a.updateRewardWithImage(l,"/theme/images/src-common/BONUSEVENT-img/DAILYCHECKIN/dailyCheckIn-treasure_gray.webp","img-treasure"),r.appendChild(a.applyTemplateBasedOnAmount(s)),a.updateProgressBasedOnRemark(n,s.remark),n.safeSelector("#treasureDiv").onclick=function(){let e=this.classList.contains("showReward");$j("div #treasureDiv").removeClass("showReward"),e||this.classList.add("showReward")},e.attr("isTodayMissionDone",!1)}else e.attr("isTodayMissionDone",!0);if(PageConfig.isLoggedIn||(t.cumulativeTicketList=[],t.cumulativeDays=0),t.cumulativeTicketList){let i=e.find("#cumulativeBoxWrapper>li"),a=t.cumulativeTicketList,n=[],s={};a.forEach((e,t)=>{let i=parseInt(e.remark.replace("CUMULATIVE-",""));e.status!=PageConfig.initialStatusCode?n.push(i):s[i]=e});let o=t.cumulativeDays,l=!0,r=0,c=0;i.each((a,d)=>{let u=$j(d),m=u.attr("cumulativeDays");if(u.find("#completedDays").html(o),n.includes(parseInt(m))){u.attr("class","got"),u.find("#treasureDiv").attr("class","treasure got"),r=m;let e=u.find("#treasureImg").attr("src").replace(`${a+1}.webp`,`${a+1}_open.webp`);u.find("#treasureImg").attr("src",e)}else if(parseInt(o)>=parseInt(m))u.attr("class","done"),u.find("#treasureDiv").attr("class","treasure done"),r=m;else if(l){l=!1,o==c?u.attr("class","undone"):u.attr("class","ing");const t=e[0].safeSelector("#cumulativeBoxWrapper"),n=i[a-1];if(n){let e=n.offsetLeft;t.scrollLeft=e}r=m}s[m]?(u.attr("bonusId",t.bonusId),u.attr("onclick",`BonusEventHandler.takeTicket(this, false, '${s[m].ticketID}')`)):u[0].safeSelector("#treasureDiv").onclick=function(){let e=this.classList.contains("showReward");$j("div #treasureDiv").removeClass("showReward"),e||this.classList.add("showReward")},c=m}),e.find("#cumulativeProgressDesc").html(`${o} / ${r} ${I18N.get("days")}`);let d=parseInt(r)-parseInt(o);d>0?e.find("#cumulativeDesc").html(I18N.get("cumulativeDesc",[d])):e.find("#cumulativeDesc").hide()}else e.find("#cumulativeArea").remove();if(PageConfig.isLoggedIn)Object.keys(n).forEach(i=>{const s=n[i];let o=e.find("#taskContent_"+i)[0],c=e.find("#calendar_"+i)[0],d=c.querySelector("#calendarReward"),u=o.querySelector("#taskReward");o.safeSelector("#treasureDiv").className="treasure",c.className="",d.innerHTML="",u.innerHTML="",o.querySelector("#missionList").innerHTML="";let m=DateUtil.getLocalDate(i+" 12:00:00"),p=t.bonusDailyMissionMap[i];p.missionList.forEach(function(e,i){let a=p.missionList.length>1?++i+". ":"",n=document.getElementById("missionTemplate").content.cloneNode(!0);n.querySelector("li").id=e.action,n.querySelector("#targetValue").textContent=e.atLeast,PageConfig.CHECK_IN==e.action&&t.isOnlyApp&&!PageConfig.isIOS?n.querySelector("#missionDesc").textContent=a+I18N.get("player.bonusEvent.missionType.appCheckin"):n.querySelector("#missionDesc").textContent=a+I18N.get(e.description),PageConfig.BET_TIMES!=e.action&&PageConfig.TURNOVER_REQUIRED!=e.action||(n.querySelector("#requiredGameListButton").style.display="",n.querySelector("#requiredGameListButton").addEventListener("click",function(){PopupUtil.openModal(`#${t.bonusId}GameList`)})),PageConfig.DEPOSIT_AMOUNT!=e.action&&PageConfig.DEPOSIT_COUNT!=e.action||!PageConfig.isAllowBanking||(n.querySelector("#bankingDepositDispatchButton").style.display=""),o.querySelector("#missionList").append(n)}),m.getTime()!==r.getTime()||l?c.classList.add("past"):c.classList.add("today"),s.status==PageConfig.initialStatusCode?a.handleRedeemableTicket(s,o,c,d):a.handleRedeemedTicket(s,o,c,d),u.appendChild(a.applyTemplateBasedOnAmount(s)),a.updateProgressBasedOnRemark(o,s.remark)});else{let i=JSON.parse(t.prizeDistribution).freeSpinSetting;$j(e).find("#bonusEventResultWrapper>li").each(function(){let n=$j(this).attr("id").split("_")[1],s={undone:!0},o=e.find("#taskContent_"+n)[0],c=e.find("#calendar_"+n)[0],d=c.querySelector("#calendarReward"),u=o.querySelector("#taskReward"),m=t.bonusDailyMissionMap[n],p=DateUtil.getLocalDate(n+" 12:00:00");m.future||(o.safeSelector("#treasureDiv").className="treasure",c.className="",d.innerHTML="",u.innerHTML="",o.querySelector("#missionList").innerHTML="",m.missionList.forEach(function(e,i){if("TURNOVER_REQUIRE_CHALLENGE"===e.action)return;let a=m.missionList.length>1?++i+". ":"",n=document.getElementById("missionTemplate").content.cloneNode(!0);n.querySelector("li").id=e.action,n.querySelector("#targetValue").textContent=e.atLeast,PageConfig.CHECK_IN==e.action&&t.isOnlyApp&&!PageConfig.isIOS?n.querySelector("#missionDesc").textContent=a+I18N.get("player.bonusEvent.missionType.appCheckin"):n.querySelector("#missionDesc").textContent=a+I18N.get(e.description),PageConfig.BET_TIMES!=e.action&&PageConfig.TURNOVER_REQUIRED!=e.action||(n.querySelector("#requiredGameListButton").style.display="",n.querySelector("#requiredGameListButton").addEventListener("click",function(){PopupUtil.openModal(`#${t.bonusId}GameList`)})),PageConfig.DEPOSIT_AMOUNT!=e.action&&PageConfig.DEPOSIT_COUNT!=e.action||!PageConfig.isAllowBanking||(n.querySelector("#bankingDepositDispatchButton").style.display=""),o.querySelector("#missionList").append(n)})),p.getTime()!==r.getTime()||l?m.future?c.classList.add("future"):c.classList.add("past"):c.classList.add("today"),m.future||a.handleRedeemedTicket(s,o,c,d),s.bonusAmt=0,s.freeSpinCount=0,s.freeSpinBaseAmt=0,s.pointAmt=0,-1!=m.reward.indexOf("Spin")?(s.freeSpinBaseAmt=i[m.reward].baseAmt,s.freeSpinCount=m.reward.split(" ")[0]):-1!=m.reward.indexOf("Point")?s.pointAmt=m.reward.split(" ")[0]:s.bonusAmt=m.reward,u.appendChild(a.applyTemplateBasedOnAmount(s)),a.updateProgressBasedOnRemark(o)})}e.find('[id^="taskContent_"]').each(function(){let t=$j(this),i=t.data("ticketDate");e.find("#calendar_"+i).removeClass("on"),t.hide()}),d.classList.add("on"),u.style.display="",l?(e.find("#dailyTitleText").text(I18N.get("dailyTask")),e.find("#todayMissionRemainingTime").hide(),e.find("#expiredSpan").show()):(e.find("#dailyTitleText").text(I18N.get("todayTask")),e.find("#todayMissionRemainingTime").show(),e.find("#expiredSpan").hide())}!function(e){e.each(function(){let e=$j(this),i=!1,a=0,n=0;e.on("mousedown",function(t){i=!0,a=t.clientX,n=e.scrollLeft(),$j("body").css("cursor","grabbing"),t.preventDefault()}),$j(document).on("mousemove",function(s){if(i){s.preventDefault(),t=!0;const i=s.clientX-a;e.scrollLeft(n-i)}}),$j(document).on("mouseup",function(){$j("body").css("cursor","default"),i=!1,setTimeout(function(){t=!1},300)}),$j(document).on("mouseleave",function(){$j("body").css("cursor","default"),i&&(i=!1)})})}($j(".calendar-box"))},startCountDown:function(e){let t=this,i=new Date,a=DateUtil.getNextSettleTime(),n=Math.abs(a-i);t.clockSec=Math.floor(n/1e3%60),t.clockMin=Math.floor(n/6e4%60),t.clockHour=Math.floor(n/36e5%24),t.setClockTime(e),setInterval(function(){t.countDown(e)},1e3)},countDown:function(e){let t=this;t.clockSec--,0==t.clockSec&&0==t.clockMin&&0==t.clockHour&&(t.clockHour=23,t.clockMin=59,t.clockSec=59),t.clockSec<0&&(t.clockMin--,t.clockSec=59,t.clockMin<0&&(t.clockHour--,t.clockMin=59)),this.setClockTime(e)},setClockTime:function(e){let t=this,i=e;i.querySelector("#clockHour").textContent=t.clockHour<10?"0"+t.clockHour:t.clockHour,i.querySelector("#clockMinute").textContent=t.clockMin<10?"0"+t.clockMin:t.clockMin,i.querySelector("#clockSecond").textContent=t.clockSec<10?"0"+t.clockSec:t.clockSec},processEvent:function(e,t,i){let a=e.map(e=>e.bonusId).join(","),n=GameHallUtils.isBS()?"BSDailyMissionTemplate":"bonusEventDailyMissionTemplate",s=t.safeSelector(`#${n}`).cloneNode(!0);s.setAttribute("onclick","BonusEventHandler.toggleBonusEvent(this)"),s.setAttribute("id","dailyMissionsDiv"),s.setAttribute("bonusId",a),s.setAttribute("presentType","DAILY_MISSION"),s.safeSelector("#dailyMissionTemplateImg").setAttribute("id","dailyMissionStickerImg"),totalTicketCount=e.reduce((e,t)=>e+(parseInt(t.ticketCount,10)||0),0);const o=e.every(e=>e.isTodayMissionDone);i.setAttribute("ticketCount",totalTicketCount),i.setAttribute("isTodayMissionDone",o),parseInt(totalTicketCount)>0||!o?(s.querySelector("#dailyMissionDot").style.display="block",s.querySelector("#dailyMissionStickerImg").src=s.querySelector("#dailyMissionStickerImg").src.replace("-static.webp",".webp")):(s.querySelector("#dailyMissionDot").style.display="none",s.querySelector("#dailyMissionStickerImg").src=s.querySelector("#dailyMissionStickerImg").src.replace(".webp","-static.webp"));let l=0,r=0;for(const t of e){let e=DateUtil.getPrevSettleTime().toISOString().split("T")[0];t.bonusDailyMissionMap[e].missionList.forEach(function(e,t){"TURNOVER_REQUIRE_CHALLENGE"==e.action&&(r=e.atLeast)});let a={bonusId:t.bonusId,platform:t.platform,cumulativeMissionName:I18N.get("cumulativeMissionName"),imagePrefixPath:PageConfig.imagePrefix,infoBoxId:t.bonusId+"InfoBox",cumulativeInfo:I18N.get("cumulativeInfo"),ticketCount:t.ticketCount,bonusMultiplier:t.bonusMultiplier,turnoverMultiplier:t.turnoverMultiplier,multiplyExpireHours:t.multiplyExpireHours,dailyMissionTurnover:r,redeemDeadlineDate:t.redeemDeadlineDate},n=$j(TemplateCache.renderTemplate("bonusEventDailyMission",a))[0],s=DateUtil.getLocalDate(t.startDate+":00:00"),o=DateUtil.getLocalDate(t.endDate+":00:00");o.setDate(o.getDate()-1);let c=DateUtil.getPrevSettleTime();c.getTime()>o.getTime()&&(c=o);let d=Math.ceil((c.getTime()-s.getTime())/864e5)+1;n.setAttribute("data-now",d);let u=t.bonusId+"InfoBox",m=document.getElementById("dailyMissionInfoTemplate").content.cloneNode(!0);m.querySelector("#infoBox").id=u,m.querySelector("#platformImg").src=`${PageConfig.imagePrefix}/theme/images/src-common/PLATFORM-img/100x100/${t.platform}-logo.webp`,m.querySelector("#infoText").innerHTML=t.footerHtml,m.querySelector(`[id='${u}']`).querySelector(".close").addEventListener("click",function(){PopupUtil.closeModal("#"+u)});let p=t.bonusId+"GameList",g=document.getElementById("requiredGameListTemplate").content.cloneNode(!0);g.querySelector("#modalGamelistDailyMission").id=p,g.querySelector(`[id='${p}']`).querySelector(".close").addEventListener("click",function(){PopupUtil.closeModal(`#${p}`)});let f=document.getElementById("gameHallDiv");if(f?(f.appendChild(m),f.appendChild(g)):(document.body.appendChild(m),document.body.appendChild(g)),"function"==typeof GameHallHandler.buildSimpleGameList){let e=document.getElementById(p).querySelector("#dailyMissionPopUl");GameHallHandler.buildSimpleGameList(t.platform,e,function(i){if(i){let i=e.querySelectorAll("li");const a=i.entries(),n=t.requiredGameList.map(e=>e.gameCode);let s=a.next();for(;s&&!s.done;){let e=s.value[1],i=e.getAttribute("game_code");t.isExcludeRequiredGames&&n.includes(i)&&e.remove(),t.isExcludeRequiredGames||n.includes(i)||t.isAllRequiredGames||e.remove(),s=a.next()}i=e.querySelectorAll("li"),i.forEach(function(t){let i={platform:t.getAttribute("platform"),gameType:t.getAttribute("gameType")},a=t.querySelector("#gameTagArea > img");if(PageConfig.showEntryGameType.includes(t.getAttribute("gameType"))){GameHallUtils.setBonusEventClass(e,i);let t=GameHallUtils.getEntryGameEventImgUrl(i);a.setAttribute("data-src",t)}t.setAttribute("isNotShowMHB",!0),t.classList.remove("show-jackpot-fire"),t.querySelector("#gameTagArea").innerHTML="",t.querySelector("#gameTagArea").append(a)}),t.challengeGameList.forEach(function(e){let i=document.getElementById(p).querySelector("#"+t.platform+"_"+e.gameKey);i&&i.remove()})}})}i.querySelector("#dailyMissionArea").appendChild(n),l++}if(1==l&&i.querySelector("#dailyMissionArea").classList.replace("moreBox","oneBox"),GameHallUtils.isNEW())PageConfig.isMobile?document.getElementById("pageHeader").querySelector(".header-logo").appendChild(s):document.body.appendChild(s);else if(GameHallUtils.isOLD())PageConfig.isMobile?document.getElementById("gameHallHeader").querySelector(".header-logo").appendChild(s):document.body.appendChild(s);else if(GameHallUtils.isRWD()||GameHallUtils.isWL()||GameHallUtils.isEZ())document.body.appendChild(s);else if(GameHallUtils.isBS()){let e=document.getElementById("subMenu");e.insertBefore(s,e.firstChild),e.style.display="flex"}},templateId:"dailyMissionPresentTemplate",className:"dailyMissionEventBonus-page",dataClear:"/theme/media/music/mixkit-instant-win-2021.wav",gameTagId:"dailyMissionBonusEventTag",clockSec:0,clockMin:0,clockHour:0}),BonusEventPresentHandler.getHandler=function(e){return BonusEventPresentHandler[e]}}();